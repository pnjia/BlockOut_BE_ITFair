generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int       @id @default(autoincrement())
  
  firstName         String
  lastName          String
  email             String    @unique
  birthDate         DateTime? 
  phoneNumber       String?   @unique
  passwordHash      String?   
  avatarUrl         String?   
  
  heightCm          Int?      
  weightKg          Int?      
  
  walletAddress     String?
  coinsBalance      Decimal   @default(0.0) @db.Decimal(18, 2)
  dayStreak         Int       @default(0)
  lastWorkout       DateTime?
  totalWorkouts     Int       @default(0)

  avatarGender      String    @default("MALE")
  equippedTop       String    @default("starter_hair")
  equippedShirt     String    @default("starter_shirt")
  equippedPants     String    @default("starter_pants")
  equippedShoes     String    @default("starter_shoes")

  notificationEnabled Boolean   @default(true)
  
  resetToken        String?
  resetTokenExpiry  DateTime?
  
  refreshToken      String?

  blockedApps       BlockedApp[]
  inventory         Inventory[]
  workoutPrefs      WorkoutPreference[]
  transactionQueue  TransactionQueue[]
  purchases         PurchaseHistory[]
  
  createdAt         DateTime  @default(now())
}

model BlockedApp {
  id        Int     @id @default(autoincrement())
  userId    Int
  appName   String
  isActive  Boolean @default(true)
  user      User    @relation(fields: [userId], references: [id])
  
  @@unique([userId, appName]) 
}

model WorkoutPreference {
  id        Int     @id @default(autoincrement())
  userId    Int
  type      String
  target    Int
  isEnabled Boolean @default(true)
  user      User    @relation(fields: [userId], references: [id])
}

model Inventory {
  id        Int      @id @default(autoincrement())
  userId    Int
  itemId    String
  itemType  String
  isOwned   Boolean  @default(true)
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, itemId])
}

model TransactionQueue {
  id            Int      @id @default(autoincrement())
  userId        Int
  walletAddress String
  amount        String
  workoutType   String
  status        String   @default("PENDING") 
  txHash        String?
  errorMessage  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
}

model PurchaseHistory {
  id        Int      @id @default(autoincrement())
  userId    Int
  itemId    String
  txHash    String   @unique
  amount    String
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
}